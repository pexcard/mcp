trigger:
  branches:
    include:
      - main

pr:
  branches:
    include:
      - main

pool:
  vmImage: "ubuntu-latest"

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "22"
    displayName: "Use Node.js 22"

  - script: npm ci
    displayName: "Install dependencies"

  - script: npm run build
    displayName: "Build & Typecheck"

  - script: npm audit --audit-level=high
    displayName: "Security audit"

  - task: CopyFiles@2
    displayName: "Copy build output"
    inputs:
      sourceFolder: $(Build.SourcesDirectory)/dist
      contents: "**"
      targetFolder: $(Build.ArtifactStagingDirectory)

  - task: PublishBuildArtifacts@1
    displayName: "Publish artifacts"
    inputs:
      PathtoPublish: "$(Build.ArtifactStagingDirectory)"
      ArtifactName: "drop"
      publishLocation: "Container"
